<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyscal.factory &mdash; pyscal 0.8.1.dev35+geebc3f9 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> pyscal
            <img src="../../_static/equinor-logo2.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.8.1.dev35+geebc3f9
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction to pyscal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modelling.html">Modelling of flooding processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to pyscal</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pyscal/pyscal.html"><code class="docutils literal notranslate"><span class="pre">pyscal</span></code></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyscal</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>pyscal.factory</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyscal.factory</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Factory functions for creating the pyscal objects&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">openpyxl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xlrd</span>

<span class="kn">from</span> <span class="nn">pyscal.utils</span> <span class="kn">import</span> <span class="n">capillarypressure</span>

<span class="kn">from</span> <span class="nn">.gasoil</span> <span class="kn">import</span> <span class="n">GasOil</span>
<span class="kn">from</span> <span class="nn">.gaswater</span> <span class="kn">import</span> <span class="n">GasWater</span>
<span class="kn">from</span> <span class="nn">.pyscallist</span> <span class="kn">import</span> <span class="n">PyscalList</span>
<span class="kn">from</span> <span class="nn">.scalrecommendation</span> <span class="kn">import</span> <span class="n">SCALrecommendation</span>
<span class="kn">from</span> <span class="nn">.wateroil</span> <span class="kn">import</span> <span class="n">WaterOil</span>
<span class="kn">from</span> <span class="nn">.wateroilgas</span> <span class="kn">import</span> <span class="n">WaterOilGas</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="slicedict"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.slicedict">[docs]</a><span class="k">def</span> <span class="nf">slicedict</span><span class="p">(</span><span class="n">dct</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Slice a dictionary for a set of keys.</span>
<span class="sd">    Keys not existing will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">dct</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">)</span></div>


<span class="c1"># Sets of dictionary keys, presence of these</span>
<span class="c1"># in incoming dictionary determines the codepaths. These must</span>
<span class="c1"># again match the API of the functions downstream in e.g. WaterOil, except</span>
<span class="c1"># for LET parameters, where the API is simplified to &#39;l&#39;, &#39;e&#39; and &#39;t&#39;.</span>
<span class="c1"># We are case *insensitive* in this factory class, so everything here should</span>
<span class="c1"># be lower case</span>
<span class="n">WO_INIT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;swirr&quot;</span><span class="p">,</span> <span class="s2">&quot;swl&quot;</span><span class="p">,</span> <span class="s2">&quot;swcr&quot;</span><span class="p">,</span> <span class="s2">&quot;sorw&quot;</span><span class="p">,</span> <span class="s2">&quot;socr&quot;</span><span class="p">,</span> <span class="s2">&quot;sgrw&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">]</span>
<span class="n">WO_COREY_WATER</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nw&quot;</span><span class="p">]</span>
<span class="n">WO_WATER_ENDPOINTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;krwmax&quot;</span><span class="p">,</span> <span class="s2">&quot;krwend&quot;</span><span class="p">]</span>
<span class="n">WO_COREY_OIL</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;now&quot;</span><span class="p">]</span>
<span class="n">WO_LET_WATER</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lw&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;tw&quot;</span><span class="p">]</span>  <span class="c1"># Will translated to l, e and t in code below.</span>
<span class="n">WO_LET_OIL</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;eow&quot;</span><span class="p">,</span> <span class="s2">&quot;tow&quot;</span><span class="p">]</span>
<span class="n">WO_LET_OIL_ALT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lo&quot;</span><span class="p">,</span> <span class="s2">&quot;eo&quot;</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">]</span>  <span class="c1"># Alternative parameter names.</span>
<span class="n">WO_OIL_ENDPOINTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;kroend&quot;</span><span class="p">]</span>
<span class="n">WO_SIMPLE_J</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;poro_ref&quot;</span><span class="p">,</span> <span class="s2">&quot;perm_ref&quot;</span><span class="p">,</span> <span class="s2">&quot;drho&quot;</span><span class="p">]</span>  <span class="c1"># &quot;g&quot; is optional</span>
<span class="n">WO_SWLHEIGHT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;swlheight&quot;</span><span class="p">]</span>
<span class="n">WO_SWCR_ADD</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;swcr_add&quot;</span><span class="p">]</span>  <span class="c1"># Relevant when swlheight is in use.</span>
<span class="n">WO_SWL_FROM_HEIGHT</span> <span class="o">=</span> <span class="n">WO_SWLHEIGHT</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;swirr&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;poro_ref&quot;</span><span class="p">,</span> <span class="s2">&quot;perm_ref&quot;</span><span class="p">]</span>
<span class="n">WO_NORM_J</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;poro&quot;</span><span class="p">,</span> <span class="s2">&quot;perm&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_costau&quot;</span><span class="p">]</span>
<span class="c1"># &#39;a&#39; in WO_NORM_J is the same as a_petro, but should possibly kept as is.</span>
<span class="n">WO_SIMPLE_J_PETRO</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;a_petro&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b_petro&quot;</span><span class="p">,</span>
    <span class="s2">&quot;poro_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;perm_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;drho&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># &quot;g&quot; is optional</span>

<span class="n">GO_INIT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;swirr&quot;</span><span class="p">,</span> <span class="s2">&quot;sgcr&quot;</span><span class="p">,</span> <span class="s2">&quot;sorg&quot;</span><span class="p">,</span> <span class="s2">&quot;sgro&quot;</span><span class="p">,</span> <span class="s2">&quot;swl&quot;</span><span class="p">,</span> <span class="s2">&quot;krgendanchor&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">]</span>
<span class="n">GO_COREY_GAS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ng&quot;</span><span class="p">]</span>
<span class="n">GO_GAS_ENDPOINTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;krgend&quot;</span><span class="p">,</span> <span class="s2">&quot;krgmax&quot;</span><span class="p">]</span>
<span class="n">GO_COREY_OIL</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nog&quot;</span><span class="p">]</span>
<span class="n">GO_OIL_ENDPOINTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;kroend&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kromax&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">GO_LET_GAS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lg&quot;</span><span class="p">,</span> <span class="s2">&quot;eg&quot;</span><span class="p">,</span> <span class="s2">&quot;tg&quot;</span><span class="p">]</span>
<span class="n">GO_LET_OIL</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="s2">&quot;eog&quot;</span><span class="p">,</span> <span class="s2">&quot;tog&quot;</span><span class="p">]</span>

<span class="n">GW_INIT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;swirr&quot;</span><span class="p">,</span> <span class="s2">&quot;swl&quot;</span><span class="p">,</span> <span class="s2">&quot;sgl&quot;</span><span class="p">,</span> <span class="s2">&quot;swcr&quot;</span><span class="p">,</span> <span class="s2">&quot;sgrw&quot;</span><span class="p">,</span> <span class="s2">&quot;sgcr&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">]</span>
<span class="n">GW_COREY_WATER</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nw&quot;</span><span class="p">]</span>
<span class="n">GW_COREY_GAS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ng&quot;</span><span class="p">]</span>
<span class="n">GW_WATER_ENDPOINTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;krwmax&quot;</span><span class="p">,</span> <span class="s2">&quot;krwend&quot;</span><span class="p">]</span>
<span class="n">GW_LET_WATER</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lw&quot;</span><span class="p">,</span> <span class="s2">&quot;ew&quot;</span><span class="p">,</span> <span class="s2">&quot;tw&quot;</span><span class="p">]</span>
<span class="n">GW_LET_GAS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lg&quot;</span><span class="p">,</span> <span class="s2">&quot;eg&quot;</span><span class="p">,</span> <span class="s2">&quot;tg&quot;</span><span class="p">]</span>
<span class="n">GW_GAS_ENDPOINTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;krgmax&quot;</span><span class="p">,</span> <span class="s2">&quot;krgend&quot;</span><span class="p">]</span>
<span class="n">GW_SIMPLE_J</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;poro_ref&quot;</span><span class="p">,</span> <span class="s2">&quot;perm_ref&quot;</span><span class="p">,</span> <span class="s2">&quot;drho&quot;</span><span class="p">]</span>  <span class="c1"># &quot;g&quot; is optional</span>
<span class="n">GW_NORM_J</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;poro&quot;</span><span class="p">,</span> <span class="s2">&quot;perm&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_costau&quot;</span><span class="p">]</span>
<span class="c1"># &#39;a&#39; in WO_NORM_J is the same as a_petro, but should possibly kept as is.</span>
<span class="n">GW_SIMPLE_J_PETRO</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;a_petro&quot;</span><span class="p">,</span>
    <span class="s2">&quot;b_petro&quot;</span><span class="p">,</span>
    <span class="s2">&quot;poro_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;perm_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;drho&quot;</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># &quot;g&quot; is optional</span>

<span class="n">WOG_INIT</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;swirr&quot;</span><span class="p">,</span> <span class="s2">&quot;swl&quot;</span><span class="p">,</span> <span class="s2">&quot;swcr&quot;</span><span class="p">,</span> <span class="s2">&quot;sorw&quot;</span><span class="p">,</span> <span class="s2">&quot;socr&quot;</span><span class="p">,</span> <span class="s2">&quot;sorg&quot;</span><span class="p">,</span> <span class="s2">&quot;sgcr&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="PyscalFactory"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory">[docs]</a><span class="k">class</span> <span class="nc">PyscalFactory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for implementing the factory pattern for Pyscal objects</span>

<span class="sd">    The factory functions herein can take multiple parameter sets,</span>
<span class="sd">    determine what kind of parametrization to be used, and set up</span>
<span class="sd">    the full objects based on these parameters, instead of</span>
<span class="sd">    explicitly having to call the API for each task.</span>

<span class="sd">    Example::</span>

<span class="sd">      wo = WaterOil(sorw=0.05)</span>
<span class="sd">      wo.add_corey_water(nw=3)</span>
<span class="sd">      wo.add_corey_oil(now=2)</span>
<span class="sd">      # is equivalent to:</span>
<span class="sd">      wo = factory.create_water_oil(dict(sorw=0.05, nw=3, now=2))</span>

<span class="sd">    Parameter names to factory functions are case *insensitive*, while</span>
<span class="sd">    the add_*() parameters are not. This is because the add_*() parameters</span>
<span class="sd">    are meant as a Python API, while the factory class is there to aid</span>
<span class="sd">    users when input is written in a different context, like an Excel</span>
<span class="sd">    spreadsheet.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PyscalFactory.create_water_oil"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_water_oil">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_water_oil</span><span class="p">(</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WaterOil</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a WaterOil object from a dictionary of parameters.</span>

<span class="sd">        Parameterization (Corey/LET) is inferred from presence</span>
<span class="sd">        of certain parameters in the dictionary.</span>

<span class="sd">        Don&#39;t rely on behaviour of you supply both Corey and LET at</span>
<span class="sd">        the same time.</span>

<span class="sd">        Parameter names in the dictionary are case insensitive. You</span>
<span class="sd">        can use Swirr, swirr, sWirR, swiRR etc.</span>

<span class="sd">        NB: the add_LET_* methods have the names &#39;l&#39;, &#39;e&#39; and &#39;t&#39;</span>
<span class="sd">        in their signatures, which is not precise enough in this</span>
<span class="sd">        context, so we require e.g. &#39;Lw&#39; and &#39;Low&#39; (which both will be</span>
<span class="sd">        translated to &#39;l&#39;)</span>

<span class="sd">        Recognized parameters:</span>
<span class="sd">          swirr, swl, swcr, sorw, socr, sgrw, h, tag, nw, now, krwmax, krwend,</span>
<span class="sd">          lw, ew, tw, low, eow, tow, lo, eo, to, kroend,</span>
<span class="sd">          a, a_petro, b, b_petro, poro_ref, perm_ref, drho,</span>
<span class="sd">          a, b, poro, perm, sigma_costau</span>

<span class="sd">        Args:</span>
<span class="sd">            params: Dictionary with parameters describing the WaterOil object.</span>
<span class="sd">            fast: If fast-mode should be set for constructed object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Parameter to create_water_oil must be a dictionary&quot;</span><span class="p">)</span>

        <span class="n">check_deprecated</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">sufficient_water_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">failhard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># For case insensitiveness, all keys are converted to lower case:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Allowing sending in NaN values, delete those keys.</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">filter_nan_from_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">usedparams</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Check if we should initialize swl from a swlheight parameter:</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_SWL_FROM_HEIGHT</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;swl&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Do not provide both swl and swlheight at the same time&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;swlheight&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;swlheight must be larger than zero&quot;</span><span class="p">)</span>
            <span class="n">params_swl_from_height</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_SWL_FROM_HEIGHT</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;swl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">capillarypressure</span><span class="o">.</span><span class="n">swl_from_height_simpleJ</span><span class="p">(</span>
                <span class="o">**</span><span class="n">params_swl_from_height</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Computed swl from swlwheight to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;swl&quot;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s2">&quot;swcr&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;swcr&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;swl&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Provided swcr=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;swcr&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> is lower than &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;computed swl=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;swl&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_SWLHEIGHT</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Can&#39;t initialize from SWLHEIGHT without sufficient &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;simple-J parameters, needs all of: </span><span class="si">{</span><span class="n">WO_SWL_FROM_HEIGHT</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Should we have a swcr relative to swl?</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_SWCR_ADD</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;swl&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;If swcr should be relative to swl, &quot;</span>
                        <span class="s2">&quot;both swcr_add and swl must be provided&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;swcr&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Do not provide both swcr and swcr_add at the same time&quot;</span>
                <span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;swcr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;swl&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="n">WO_SWCR_ADD</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># No requirements to the base objects, defaults are ok.</span>
        <span class="n">wateroil</span> <span class="o">=</span> <span class="n">WaterOil</span><span class="p">(</span>
            <span class="o">**</span><span class="n">PyscalFactory</span><span class="o">.</span><span class="n">alias_sgrw</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_INIT</span><span class="p">)),</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span>
        <span class="p">)</span>
        <span class="n">usedparams</span> <span class="o">=</span> <span class="n">usedparams</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_INIT</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Initialized WaterOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">usedparams</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Water curve</span>
        <span class="n">params_corey_water</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_COREY_WATER</span> <span class="o">+</span> <span class="n">WO_WATER_ENDPOINTS</span><span class="p">)</span>
        <span class="n">params_let_water</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_LET_WATER</span> <span class="o">+</span> <span class="n">WO_WATER_ENDPOINTS</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_COREY_WATER</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_corey_water</span><span class="p">)):</span>
            <span class="n">wateroil</span><span class="o">.</span><span class="n">add_corey_water</span><span class="p">(</span><span class="o">**</span><span class="n">params_corey_water</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added Corey water to WaterOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_corey_water</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_LET_WATER</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_let_water</span><span class="p">)):</span>
            <span class="n">params_let_water</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_water</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lw&quot;</span><span class="p">)</span>
            <span class="n">params_let_water</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_water</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;ew&quot;</span><span class="p">)</span>
            <span class="n">params_let_water</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_water</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tw&quot;</span><span class="p">)</span>
            <span class="n">wateroil</span><span class="o">.</span><span class="n">add_LET_water</span><span class="p">(</span><span class="o">**</span><span class="n">params_let_water</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added LET water to WaterOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_let_water</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>

        <span class="c1"># Oil curve:</span>
        <span class="n">params_corey_oil</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_COREY_OIL</span> <span class="o">+</span> <span class="n">WO_OIL_ENDPOINTS</span><span class="p">)</span>
        <span class="n">params_let_oil</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span>
            <span class="n">params</span><span class="p">,</span> <span class="n">WO_LET_OIL</span> <span class="o">+</span> <span class="n">WO_LET_OIL_ALT</span> <span class="o">+</span> <span class="n">WO_OIL_ENDPOINTS</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_COREY_OIL</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_corey_oil</span><span class="p">)):</span>
            <span class="n">wateroil</span><span class="o">.</span><span class="n">add_corey_oil</span><span class="p">(</span><span class="o">**</span><span class="n">params_corey_oil</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added Corey water to WaterOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_corey_oil</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_LET_OIL</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_let_oil</span><span class="p">)):</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;low&quot;</span><span class="p">)</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;eow&quot;</span><span class="p">)</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tow&quot;</span><span class="p">)</span>
            <span class="n">wateroil</span><span class="o">.</span><span class="n">add_LET_oil</span><span class="p">(</span><span class="o">**</span><span class="n">params_let_oil</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added LET water to WaterOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_let_oil</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_LET_OIL_ALT</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_let_oil</span><span class="p">)):</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lo&quot;</span><span class="p">)</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;eo&quot;</span><span class="p">)</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;to&quot;</span><span class="p">)</span>
            <span class="n">wateroil</span><span class="o">.</span><span class="n">add_LET_oil</span><span class="p">(</span><span class="o">**</span><span class="n">params_let_oil</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added LET water to WaterOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_let_oil</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>

        <span class="c1"># Capillary pressure:</span>
        <span class="n">params_simple_j</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_SIMPLE_J</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">])</span>
        <span class="n">params_norm_j</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_NORM_J</span><span class="p">)</span>
        <span class="n">params_simple_j_petro</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WO_SIMPLE_J_PETRO</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_SIMPLE_J</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_simple_j</span><span class="p">)):</span>
            <span class="n">wateroil</span><span class="o">.</span><span class="n">add_simple_J</span><span class="p">(</span><span class="o">**</span><span class="n">params_simple_j</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_SIMPLE_J_PETRO</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_simple_j_petro</span><span class="p">)):</span>
            <span class="n">params_simple_j_petro</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_simple_j_petro</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;a_petro&quot;</span><span class="p">)</span>
            <span class="n">params_simple_j_petro</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_simple_j_petro</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;b_petro&quot;</span><span class="p">)</span>
            <span class="n">wateroil</span><span class="o">.</span><span class="n">add_simple_J_petro</span><span class="p">(</span><span class="o">**</span><span class="n">params_simple_j_petro</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_NORM_J</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_norm_j</span><span class="p">)):</span>
            <span class="n">wateroil</span><span class="o">.</span><span class="n">add_normalized_J</span><span class="p">(</span><span class="o">**</span><span class="n">params_norm_j</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Missing or ambiguous parameters for capillary pressure in &quot;</span>
                    <span class="s2">&quot;WaterOil object. Using zero.&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wateroil</span><span class="o">.</span><span class="n">selfcheck</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Incomplete WaterOil object, some parameters missing to factory&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">wateroil</span></div>

<div class="viewcode-block" id="PyscalFactory.create_gas_oil"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_gas_oil">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_gas_oil</span><span class="p">(</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GasOil</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a GasOil object from a dictionary of parameters.</span>

<span class="sd">        Parameterization (Corey/LET) is inferred from presence</span>
<span class="sd">        of certain parameters in the dictionary.</span>

<span class="sd">        Don&#39;t rely on behaviour of you supply both Corey and LET at</span>
<span class="sd">        the same time.</span>

<span class="sd">        NB: the add_LET_* methods have the names &#39;l&#39;, &#39;e&#39; and &#39;t&#39;</span>
<span class="sd">        in their signatures, which is not precise enough in this</span>
<span class="sd">        context, so we require e.g. &#39;Lg&#39; and &#39;Log&#39; (which both will be</span>
<span class="sd">        translated to &#39;l&#39;).</span>

<span class="sd">        Recognized parameters:</span>
<span class="sd">          swirr, sgcr, sorg, swl, krgendanchor, h, tag,</span>
<span class="sd">          ng, krgend, krgmax, nog, kroend, kromax</span>
<span class="sd">          lg, eg, tg, log, eog, tog</span>

<span class="sd">        Args:</span>
<span class="sd">            params: Dictionary with parameters describing the GasOil object.</span>
<span class="sd">            fast: If fast-mode should be set for constructed object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Parameter to create_gas_oil must be a dictionary&quot;</span><span class="p">)</span>

        <span class="n">check_deprecated</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">sufficient_gas_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">failhard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># For case insensitiveness, all keys are converted to lower case:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="c1"># Allowing sending in NaN values, delete those keys.</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">filter_nan_from_dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">usedparams</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># No requirements to the base objects, defaults are ok.</span>
        <span class="n">gasoil</span> <span class="o">=</span> <span class="n">GasOil</span><span class="p">(</span><span class="o">**</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">GO_INIT</span><span class="p">),</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
        <span class="n">usedparams</span> <span class="o">=</span> <span class="n">usedparams</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">GO_INIT</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Initialized GasOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">usedparams</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Gas curve</span>
        <span class="n">params_corey_gas</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">GO_COREY_GAS</span> <span class="o">+</span> <span class="n">GO_GAS_ENDPOINTS</span><span class="p">)</span>
        <span class="n">params_let_gas</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">GO_LET_GAS</span> <span class="o">+</span> <span class="n">GO_GAS_ENDPOINTS</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">GO_COREY_GAS</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_corey_gas</span><span class="p">)):</span>
            <span class="n">gasoil</span><span class="o">.</span><span class="n">add_corey_gas</span><span class="p">(</span><span class="o">**</span><span class="n">params_corey_gas</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added Corey gas to GasOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_corey_gas</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">GO_LET_GAS</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_let_gas</span><span class="p">)):</span>
            <span class="n">params_let_gas</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_gas</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;lg&quot;</span><span class="p">)</span>
            <span class="n">params_let_gas</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_gas</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;eg&quot;</span><span class="p">)</span>
            <span class="n">params_let_gas</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_gas</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tg&quot;</span><span class="p">)</span>
            <span class="n">gasoil</span><span class="o">.</span><span class="n">add_LET_gas</span><span class="p">(</span><span class="o">**</span><span class="n">params_let_gas</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added LET gas to GasOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_let_gas</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Missing or ambiguous parameters for gas curve in GasOil object&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Oil curve:</span>
        <span class="n">params_corey_oil</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">GO_COREY_OIL</span> <span class="o">+</span> <span class="n">GO_OIL_ENDPOINTS</span><span class="p">)</span>
        <span class="n">params_let_oil</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">GO_LET_OIL</span> <span class="o">+</span> <span class="n">GO_OIL_ENDPOINTS</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">GO_COREY_OIL</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_corey_oil</span><span class="p">)):</span>
            <span class="n">gasoil</span><span class="o">.</span><span class="n">add_corey_oil</span><span class="p">(</span><span class="o">**</span><span class="n">params_corey_oil</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added Corey gas to GasOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_corey_oil</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">set</span><span class="p">(</span><span class="n">GO_LET_OIL</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">params_let_oil</span><span class="p">)):</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;eog&quot;</span><span class="p">)</span>
            <span class="n">params_let_oil</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_let_oil</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;tog&quot;</span><span class="p">)</span>
            <span class="n">gasoil</span><span class="o">.</span><span class="n">add_LET_oil</span><span class="p">(</span><span class="o">**</span><span class="n">params_let_oil</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Added LET gas to GasOil object from parameters </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">params_let_oil</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Missing or ambiguous parameters for oil curve in GasOil object&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gasoil</span><span class="o">.</span><span class="n">selfcheck</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Incomplete GasOil object, some parameters missing to factory&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">gasoil</span></div>

<div class="viewcode-block" id="PyscalFactory.create_water_oil_gas"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_water_oil_gas">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_water_oil_gas</span><span class="p">(</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">WaterOilGas</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a WaterOilGas object from a dictionary of parameters</span>

<span class="sd">        Parameterization (Corey/LET) is inferred from presence</span>
<span class="sd">        of certain parameters in the dictionary.</span>

<span class="sd">        Check create_water_oil() and create_gas_oil() for lists</span>
<span class="sd">        of supported parameters (case insensitive)</span>

<span class="sd">        Params:</span>
<span class="sd">            params: Dictionary with parameters describing the WaterOilGas object.</span>
<span class="sd">            fast: If fast-mode should be set for constructed object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Parameter to create_water_oil_gas must be a dictionary&quot;</span><span class="p">)</span>

        <span class="n">check_deprecated</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># For case insensitiveness, all keys are converted to lower case:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="n">wateroil</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">WaterOil</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sufficient_water_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">failhard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">wateroil</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_water_oil</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No wateroil parameters. Assuming only gas-oil in wateroilgas&quot;</span><span class="p">)</span>
            <span class="n">wateroil</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If the swl in WaterOil was initialized with swlheight,</span>
        <span class="c1"># ensure that result is passed on to the GasOil object:</span>
        <span class="k">if</span> <span class="s2">&quot;swl&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">and</span> <span class="s2">&quot;swlheight&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">and</span> <span class="n">wateroil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;swl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wateroil</span><span class="o">.</span><span class="n">swl</span>

        <span class="n">gasoil</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GasOil</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sufficient_gas_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">failhard</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">gasoil</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_gas_oil</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No gasoil parameters, assuming two-phase oilwatergas&quot;</span><span class="p">)</span>
            <span class="n">gasoil</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">wog_init_params</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">WOG_INIT</span><span class="p">)</span>
        <span class="n">wateroilgas</span> <span class="o">=</span> <span class="n">WaterOilGas</span><span class="p">(</span><span class="o">**</span><span class="n">wog_init_params</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
        <span class="c1"># The wateroilgas __init__ has already created WaterOil and GasOil objects</span>
        <span class="c1"># but we overwrite the references with newly created ones, this factory function</span>
        <span class="c1"># must then guarantee that they are compatible.</span>
        <span class="n">wateroilgas</span><span class="o">.</span><span class="n">wateroil</span> <span class="o">=</span> <span class="n">wateroil</span>  <span class="c1"># This might be None</span>
        <span class="n">wateroilgas</span><span class="o">.</span><span class="n">gasoil</span> <span class="o">=</span> <span class="n">gasoil</span>  <span class="c1"># This might be None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wateroilgas</span><span class="o">.</span><span class="n">selfcheck</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Inconsistent WaterOilGas object. Bug? Input was </span><span class="si">{</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">wateroilgas</span></div>

<div class="viewcode-block" id="PyscalFactory.create_gas_water"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_gas_water">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_gas_water</span><span class="p">(</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GasWater</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a GasWater object.</span>

<span class="sd">        Parameterization (Corey/LET) is inferred from presence</span>
<span class="sd">        of certain parameters in the dictionary.</span>

<span class="sd">        Args:</span>
<span class="sd">            params: Dictionary with parameters for GasWater.</span>
<span class="sd">            fast: If fast-mode should be set for constructed object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Parameter to create_gas_water must be a dictionary&quot;</span><span class="p">)</span>

        <span class="c1"># For case insensitiveness, all keys are converted to lower case:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="n">sufficient_gas_water_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">failhard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">gw_init_params</span> <span class="o">=</span> <span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">GW_INIT</span><span class="p">)</span>
        <span class="n">gaswater</span> <span class="o">=</span> <span class="n">GasWater</span><span class="p">(</span><span class="o">**</span><span class="n">gw_init_params</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>

        <span class="c1"># We are using the create_water_oil_gas factory function</span>
        <span class="c1"># to avoid replicating code. It works because GasWater and</span>
        <span class="c1"># WaterOilGas internally are very similar.</span>
        <span class="n">wog_params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;sgrw&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">wog_params</span><span class="p">[</span><span class="s2">&quot;sorw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sgrw&quot;</span><span class="p">]</span>
        <span class="c1"># Set some dummy parameters for oil:</span>
        <span class="n">wog_params</span><span class="p">[</span><span class="s2">&quot;nog&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">wog_params</span><span class="p">[</span><span class="s2">&quot;now&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">wog</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_water_oil_gas</span><span class="p">(</span><span class="n">wog_params</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">wog</span><span class="o">.</span><span class="n">wateroil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">wog</span><span class="o">.</span><span class="n">gasoil</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">gaswater</span><span class="o">.</span><span class="n">wateroil</span> <span class="o">=</span> <span class="n">wog</span><span class="o">.</span><span class="n">wateroil</span>
        <span class="n">gaswater</span><span class="o">.</span><span class="n">gasoil</span> <span class="o">=</span> <span class="n">wog</span><span class="o">.</span><span class="n">gasoil</span>
        <span class="k">return</span> <span class="n">gaswater</span></div>

<div class="viewcode-block" id="PyscalFactory.create_scal_recommendation"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_scal_recommendation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_scal_recommendation</span><span class="p">(</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">h</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SCALrecommendation</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set up a SCAL recommendation curve set from input as a</span>
<span class="sd">        dictionary of dictionary.</span>

<span class="sd">        The keys in in the dictionary *must* be &quot;low&quot;, &quot;base&quot; and &quot;high&quot;.</span>

<span class="sd">        The value for &quot;low&quot; must be a new dictionary with saturation</span>
<span class="sd">        endpoints and LET/Corey parameters, as you would feed it to</span>
<span class="sd">        the create_water_oil_gas() factory function, and then similarly</span>
<span class="sd">        for base and high.</span>

<span class="sd">        For oil-water only, you may omit the parameters for gas-oil.</span>
<span class="sd">        A WaterOilGas object for each case is created, but only the</span>
<span class="sd">        WaterOil part of it will be used.</span>

<span class="sd">        For gas-water, a GasWater object is created for each pess, base</span>
<span class="sd">        and high.</span>

<span class="sd">        Args:</span>
<span class="sd">            params: keys low, base and high.</span>
<span class="sd">                The value for &quot;low&quot; must be a new dictionary with saturation</span>
<span class="sd">                endpoints and LET/Corey parameters, as you would feed it to</span>
<span class="sd">                the create_water_oil_gas() factory function, and then similarly</span>
<span class="sd">                for base and high.</span>
<span class="sd">            tag: String to be used as the tag, will end up in comments.</span>
<span class="sd">            h: Saturation step length</span>
<span class="sd">            fast: If fast-mode should be set for constructed object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input must be a dictionary (of dictionaries)&quot;</span><span class="p">)</span>

        <span class="c1"># For case insensitiveness, all keys are converted to lower case:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">if</span> <span class="s2">&quot;low&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;low&quot; case not supplied&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;base&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;base&quot; case not supplied&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;high&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;high&quot; case not supplied&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All values in parameter dict must be dictionaries&quot;</span><span class="p">)</span>

        <span class="n">check_deprecated</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">])</span>
        <span class="n">check_deprecated</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">])</span>
        <span class="n">check_deprecated</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">])</span>

        <span class="n">errored</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>

        <span class="c1"># Check parameter availability, in order to determine phase configuration</span>
        <span class="n">gaswater</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">sufficient_gas_water_params</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">case</span><span class="p">])</span> <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">gasoil</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">sufficient_gas_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">case</span><span class="p">])</span> <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">wateroil</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">sufficient_water_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">case</span><span class="p">])</span> <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">wog_low</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">WaterOilGas</span><span class="p">,</span> <span class="n">GasWater</span><span class="p">]</span>
        <span class="n">wog_base</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">WaterOilGas</span><span class="p">,</span> <span class="n">GasWater</span><span class="p">]</span>
        <span class="n">wog_high</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">WaterOilGas</span><span class="p">,</span> <span class="n">GasWater</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">wateroil</span> <span class="ow">or</span> <span class="n">gasoil</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wog_low</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_water_oil_gas</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">],</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with low/pess case: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wog_base</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_water_oil_gas</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">],</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with base case: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wog_high</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_water_oil_gas</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">],</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with high/opt case: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="k">elif</span> <span class="n">gaswater</span><span class="p">:</span>
            <span class="c1"># Note that gaswater will be True in three-phase configs.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wog_low</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_gas_water</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">],</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with low/pess case: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wog_base</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_gas_water</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">],</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with base case: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wog_high</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_gas_water</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">],</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Problem with high/opt case: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="n">errored</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">wog</span><span class="o">.</span><span class="n">selfcheck</span><span class="p">()</span> <span class="k">for</span> <span class="n">wog</span> <span class="ow">in</span> <span class="p">[</span><span class="n">wog_low</span><span class="p">,</span> <span class="n">wog_base</span><span class="p">,</span> <span class="n">wog_high</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">errored</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incomplete SCAL recommendation&quot;</span><span class="p">)</span>

        <span class="n">scal</span> <span class="o">=</span> <span class="n">SCALrecommendation</span><span class="p">(</span><span class="n">wog_low</span><span class="p">,</span> <span class="n">wog_base</span><span class="p">,</span> <span class="n">wog_high</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scal</span></div>

<div class="viewcode-block" id="PyscalFactory.load_relperm_df"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.load_relperm_df">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load_relperm_df</span><span class="p">(</span>
        <span class="n">inputfile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="n">sheet_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Read CSV or XLSX from file and return scal/relperm data</span>
<span class="sd">        a dataframe.</span>

<span class="sd">        Checks validity in SATNUM and CASE columns.</span>
<span class="sd">        Ensures case-insensitiveness SATNUM, CASE, TAG and COMMENT</span>

<span class="sd">        Merges COMMENT into TAG column, as only TAG is picked up downstream.</span>
<span class="sd">        Adds a prefix &quot;SATNUM &lt;number&gt;&quot; to all tags.</span>

<span class="sd">        All strings in CASE column are converted to lowercase. Applies</span>
<span class="sd">        aliasing in the CASE column so that &quot;pessimistic&quot; and &quot;pess&quot; map to</span>
<span class="sd">        &quot;low&quot;, and &quot;optimistic&quot; and &quot;opt&quot; map to &quot;high&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            inputfile: Filename for XLSX or CSV file, or a</span>
<span class="sd">                pandas DataFrame.</span>
<span class="sd">            sheet_name: Sheet-name, only used when loading xlsx files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            To be handed over to pyscal list factory methods.</span>
<span class="sd">            Empty dataframe in case of errors (messages will be logged).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputfile</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span> <span class="ow">and</span> <span class="n">Path</span><span class="p">(</span><span class="n">inputfile</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="n">tabular_file_format</span> <span class="o">=</span> <span class="n">infer_tabular_file_format</span><span class="p">(</span><span class="n">inputfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tabular_file_format</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Impossible to infer file format for </span><span class="si">{</span><span class="n">inputfile</span><span class="si">}</span><span class="s2">, not CSV/XLS/XLSX&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">tabular_file_format</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span> <span class="ow">and</span> <span class="n">sheet_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Sheet name only relevant for XLSX files, ignoring </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sheet_name</span>
                <span class="p">)</span>
            <span class="n">excel_engines</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xls&quot;</span><span class="p">:</span> <span class="s2">&quot;xlrd&quot;</span><span class="p">,</span> <span class="s2">&quot;xlsx&quot;</span><span class="p">:</span> <span class="s2">&quot;openpyxl&quot;</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">tabular_file_format</span> <span class="o">!=</span> <span class="s2">&quot;csv&quot;</span> <span class="ow">and</span> <span class="n">sheet_name</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
                        <span class="n">inputfile</span><span class="p">,</span>
                        <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span>
                        <span class="n">engine</span><span class="o">=</span><span class="n">excel_engines</span><span class="p">[</span><span class="n">tabular_file_format</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Parsed </span><span class="si">%s</span><span class="s2"> file </span><span class="si">%s</span><span class="s2">, sheet </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">tabular_file_format</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span>
                        <span class="n">inputfile</span><span class="p">,</span>
                        <span class="n">sheet_name</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Non-existing sheet-name </span><span class="si">{</span><span class="n">sheet_name</span><span class="si">}</span><span class="s2"> provided.&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
            <span class="k">elif</span> <span class="n">tabular_file_format</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;xls&quot;</span><span class="p">):</span>
                <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
                    <span class="n">inputfile</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="n">excel_engines</span><span class="p">[</span><span class="n">tabular_file_format</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parsed </span><span class="si">%s</span><span class="s2"> file </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tabular_file_format</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">inputfile</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                    <span class="n">inputfile</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Parsed CSV file </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">inputfile</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputfile</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">input_df</span> <span class="o">=</span> <span class="n">inputfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputfile</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">inputfile</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;File not found &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inputfile</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported argument &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">inputfile</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">input_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Relperm input dataframe is empty!&quot;</span><span class="p">)</span>

        <span class="c1"># We will ignore case on the column names, solved by converting column</span>
        <span class="c1"># name to uppercase</span>
        <span class="n">ignorecasecolumns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;satnum&quot;</span><span class="p">,</span> <span class="s2">&quot;case&quot;</span><span class="p">,</span> <span class="s2">&quot;tag&quot;</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ignorecasecolumns</span><span class="p">:</span>
                <span class="n">input_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">colname</span><span class="p">:</span> <span class="n">colname</span><span class="o">.</span><span class="n">upper</span><span class="p">()},</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

        <span class="c1"># Support both TAG and COLUMN (as TAG)</span>
        <span class="k">if</span> <span class="s2">&quot;COMMENT&quot;</span> <span class="ow">in</span> <span class="n">input_df</span> <span class="ow">and</span> <span class="s2">&quot;TAG&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_df</span><span class="p">:</span>
            <span class="n">input_df</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;COMMENT&quot;</span><span class="p">:</span> <span class="s2">&quot;TAG&quot;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;COMMENT&quot;</span> <span class="ow">in</span> <span class="n">input_df</span> <span class="ow">and</span> <span class="s2">&quot;TAG&quot;</span> <span class="ow">in</span> <span class="n">input_df</span><span class="p">:</span>
            <span class="c1"># It might never happen that a user puts both tag and comment in</span>
            <span class="c1"># the dataframe, but if so, merge them.</span>
            <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;TAG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;tag: &quot;</span> <span class="o">+</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;TAG&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;; comment: &quot;</span> <span class="o">+</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;COMMENT&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># It is tempting to detect any NaN&#39;s at this point because that can</span>
        <span class="c1"># indicate merged cells, which is not supported, but that could</span>
        <span class="c1"># break optional comment columns which might only be defined on certain lines.</span>
        <span class="k">if</span> <span class="s2">&quot;SATNUM&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_df</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;SATNUM must be present in CSV/XLSX file/dataframe&quot;</span><span class="p">)</span>

        <span class="c1"># Delete columns and rows that are all NaNs (this has been observed</span>
        <span class="c1"># to occur from seemingly empty cells in Excel/LibreOffice and</span>
        <span class="c1"># has been seen to vary with Pandas/Openpyxl versions in use)</span>
        <span class="n">input_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">input_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Found not-a-number in the SATNUM column. This could be due to &quot;</span>
                <span class="s2">&quot;merged cells in XLSX, which is not supported.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Warn about any other columns with empty cells:</span>
        <span class="n">nan_columns</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">input_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()])</span>
        <span class="n">allowed_nan_columns</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;COMMENT&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">nan_columns</span> <span class="o">-</span> <span class="n">allowed_nan_columns</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Found empty cells in these columns, this might create trouble: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">nan_columns</span> <span class="o">-</span> <span class="n">allowed_nan_columns</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Check that SATNUM&#39;s are consecutive and integers:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;SATNUM must contain only integers&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;SATNUM must start at 1&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Missing SATNUMs? Max SATNUM is not equal to number of unique SATNUMS&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;CASE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_df</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_df</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Non-unique SATNUMs?&quot;</span><span class="p">)</span>
        <span class="c1"># If we are in a SCAL recommendation setting</span>
        <span class="k">if</span> <span class="s2">&quot;CASE&quot;</span> <span class="ow">in</span> <span class="n">input_df</span><span class="p">:</span>
            <span class="c1"># Enforce lower case:</span>
            <span class="k">if</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;CASE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Found not-a-number in the CASE column. This could be due &quot;</span>
                    <span class="s2">&quot;merged cells in XLSX, which is not supported.&quot;</span>
                <span class="p">)</span>
            <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;CASE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">remap_validate_cases</span><span class="p">(</span>
                <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;CASE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="p">)</span>

        <span class="c1"># Add the SATNUM index to the TAG column</span>
        <span class="k">if</span> <span class="s2">&quot;TAG&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">input_df</span><span class="p">:</span>
            <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;TAG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;TAG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Empty cells to empty string.</span>
        <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;TAG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;SATNUM &quot;</span> <span class="o">+</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;TAG&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Check if fast is defined as a column</span>
        <span class="k">if</span> <span class="s2">&quot;fast&quot;</span> <span class="ow">in</span> <span class="n">input_df</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Fast mode is not an option for individual SATNUMs&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;it is implemented as a global option.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The fast column in the dataframe will be ignored.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Use fast=True in the function call instead.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Fast mode is only available through the Python API&quot;</span><span class="p">)</span>

        <span class="c1"># Check that we are able to make something out of the first row:</span>
        <span class="n">firstrow</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">wo_ok</span> <span class="o">=</span> <span class="n">sufficient_water_oil_params</span><span class="p">(</span><span class="n">firstrow</span><span class="p">)</span>
        <span class="n">go_ok</span> <span class="o">=</span> <span class="n">sufficient_gas_oil_params</span><span class="p">(</span><span class="n">firstrow</span><span class="p">)</span>
        <span class="n">gw_ok</span> <span class="o">=</span> <span class="n">sufficient_gas_water_params</span><span class="p">(</span><span class="n">firstrow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">wo_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">go_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">gw_ok</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t make neither WaterOil, GasOil or GasWater from &quot;</span>
                <span class="s2">&quot;the given data. Check documentation for what you need to supply. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;You provided the columns </span><span class="si">{</span><span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Loaded input data with </span><span class="si">%s</span><span class="s2"> SATNUMS, column </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">input_df</span><span class="p">[</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">input_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">input_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyscalFactory.alias_sgrw"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.alias_sgrw">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">alias_sgrw</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Allow sgrw as an alias for sorw by remapping a</span>
<span class="sd">        sgrw value to a sorw value in an incoming dict.</span>

<span class="sd">        Will error hard of sorw already exists and is not nan.</span>

<span class="sd">        This aliasing is relevant when GasWater is modelled</span>
<span class="sd">        as three-phase to allow for condensate forming, and mirrors</span>
<span class="sd">        GasWater.__init__() which performs the same aliasing.</span>

<span class="sd">        Args:</span>
<span class="sd">            params: Keys must be lower case.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;sgrw&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;sorw&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">or</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;sorw&quot;</span><span class="p">]):</span>
                <span class="n">params_copy</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
                <span class="n">params_copy</span><span class="p">[</span><span class="s2">&quot;sorw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sgrw&quot;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">params_copy</span><span class="p">[</span><span class="s2">&quot;sgrw&quot;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">params_copy</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;sgrw&quot;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;sorw&quot;</span><span class="p">]):</span>
                <span class="n">params_copy</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">params_copy</span><span class="p">[</span><span class="s2">&quot;sgrw&quot;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">params_copy</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;sgrw (</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sgrw&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) must equal sorw (</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;sorw&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="s2">&quot;when both are supplied to WaterOil.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="PyscalFactory.remap_validate_cases"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.remap_validate_cases">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remap_validate_cases</span><span class="p">(</span><span class="n">casevalues</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Remap values in the CASE column so that we can use aliases.</span>

<span class="sd">        All values are first made lower case, then</span>
<span class="sd">        &quot;pessimistic&quot; and &quot;pess&quot; are mapped to &quot;low&quot; and</span>
<span class="sd">        &quot;optimistic&quot; and &quot;opt&quot; are mapped to &quot;high&quot;.</span>

<span class="sd">        Will raise ValueError if some values are not understood, and</span>
<span class="sd">        if we don&#39;t have exactly three unique values.</span>

<span class="sd">        Args:</span>
<span class="sd">            casevalues: values to remap.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">accepted</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;base&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">]</span>
        <span class="n">aliases</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;pessimistic&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pess&quot;</span><span class="p">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
            <span class="s2">&quot;optimistic&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
            <span class="s2">&quot;opt&quot;</span><span class="p">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">lowered</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">casevalues</span><span class="p">]</span>
        <span class="n">remapped</span> <span class="o">=</span> <span class="p">[</span><span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lowered</span><span class="p">]</span>
        <span class="n">not_understood</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">remapped</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">accepted</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">not_understood</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid case values: </span><span class="si">{</span><span class="n">not_understood</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">remapped</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">accepted</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;You must supply low, base AND high, got only </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">remapped</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">remapped</span></div>

<div class="viewcode-block" id="PyscalFactory.create_scal_recommendation_list"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_scal_recommendation_list">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_scal_recommendation_list</span><span class="p">(</span>
        <span class="n">input_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PyscalList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Requires SATNUM and CASE to be defined in the input data</span>

<span class="sd">        Args:</span>
<span class="sd">            input_df: Input data, should have been processed</span>
<span class="sd">                through load_relperm_df().</span>
<span class="sd">            h: Saturation step-value</span>
<span class="sd">            fast: If fast-mode should be set for constructed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            PyscalList, consisting of SCALrecommendation objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scal_l</span> <span class="o">=</span> <span class="n">PyscalList</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>

        <span class="n">scalinput</span> <span class="o">=</span> <span class="n">input_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">,</span> <span class="s2">&quot;CASE&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">satnum</span> <span class="ow">in</span> <span class="n">scalinput</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="c1"># load_relperm_df only validates the CASE column for all SATNUMs at</span>
            <span class="c1"># once, errors for particular SATNUMs are caught here.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scalinput</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">satnum</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Too many cases supplied for SATNUM </span><span class="si">{</span><span class="n">satnum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scalinput</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">satnum</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Too few cases supplied for SATNUM </span><span class="si">{</span><span class="n">satnum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">scal_l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_scal_recommendation</span><span class="p">(</span>
                        <span class="n">scalinput</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">satnum</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">),</span> <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error for SATNUM </span><span class="si">{</span><span class="n">satnum</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="k">return</span> <span class="n">scal_l</span></div>

<div class="viewcode-block" id="PyscalFactory.create_pyscal_list"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_pyscal_list">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_pyscal_list</span><span class="p">(</span>
        <span class="n">relperm_params_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create WaterOilGas, WaterOil, GasOil or GasWater list</span>
<span class="sd">        based on what is available</span>

<span class="sd">        Args:</span>
<span class="sd">            relperm_params_df: Input data, should have been processed</span>
<span class="sd">                through load_relperm_df().</span>
<span class="sd">            h: Saturation step-value</span>
<span class="sd">            fast: If fast-mode should be set for constructed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            PyscalList, consisting of either WaterOil, GasOil or WaterOilGas objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">relperm_params_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># first row</span>
        <span class="n">water_oil</span> <span class="o">=</span> <span class="n">sufficient_water_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">gas_oil</span> <span class="o">=</span> <span class="n">sufficient_gas_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">gas_water</span> <span class="o">=</span> <span class="n">sufficient_gas_water_params</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">water_oil</span> <span class="ow">and</span> <span class="n">gas_oil</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_wateroilgas_list</span><span class="p">(</span><span class="n">relperm_params_df</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">water_oil</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_wateroil_list</span><span class="p">(</span><span class="n">relperm_params_df</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gas_oil</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_gasoil_list</span><span class="p">(</span><span class="n">relperm_params_df</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gas_water</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_gaswater_list</span><span class="p">(</span><span class="n">relperm_params_df</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not determine two or three phase from parameters&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PyscalFactory.create_wateroilgas_list"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_wateroilgas_list">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_wateroilgas_list</span><span class="p">(</span>
        <span class="n">relperm_params_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PyscalList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a PyscalList with WaterOilGas objects from</span>
<span class="sd">        a dataframe</span>

<span class="sd">        Args:</span>
<span class="sd">            relperm_params_df: Input data, should have been processed</span>
<span class="sd">                through load_relperm_df().</span>
<span class="sd">            h: Saturation step-value</span>
<span class="sd">            fast: If fast-mode should be set for constructed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            PyscalList, consisting of WaterOilGas objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wogl</span> <span class="o">=</span> <span class="n">PyscalList</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="n">relperm_params_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;SATNUM&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wogl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_water_oil_gas</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error for SATNUM </span><span class="si">{</span><span class="n">row_idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="k">return</span> <span class="n">wogl</span></div>

<div class="viewcode-block" id="PyscalFactory.create_wateroil_list"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_wateroil_list">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_wateroil_list</span><span class="p">(</span>
        <span class="n">relperm_params_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PyscalList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a PyscalList with WaterOil objects from</span>
<span class="sd">        a dataframe</span>

<span class="sd">        Args:</span>
<span class="sd">            relperm_params_df: A valid dataframe with</span>
<span class="sd">                WaterOil parameters, processed through load_relperm_df()</span>
<span class="sd">            h: Saturation steplength</span>
<span class="sd">            fast: If fast-mode should be set for constructed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            PyscalList, consisting of WaterOil objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wol</span> <span class="o">=</span> <span class="n">PyscalList</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="n">relperm_params_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_water_oil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error for SATNUM </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SATNUM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="k">return</span> <span class="n">wol</span></div>

<div class="viewcode-block" id="PyscalFactory.create_gasoil_list"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_gasoil_list">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_gasoil_list</span><span class="p">(</span>
        <span class="n">relperm_params_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PyscalList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a PyscalList with GasOil objects from</span>
<span class="sd">        a dataframe</span>

<span class="sd">        Args:</span>
<span class="sd">            relperm_params_df: A valid dataframe with GasOil parameters,</span>
<span class="sd">                processed through load_relperm_df()</span>
<span class="sd">            h: Saturation steplength</span>
<span class="sd">            fast: If fast-mode should be set for constructed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            PyscalList, consisting of GasOil objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gol</span> <span class="o">=</span> <span class="n">PyscalList</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="n">relperm_params_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">gol</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_gas_oil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error for SATNUM </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SATNUM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="k">return</span> <span class="n">gol</span></div>

<div class="viewcode-block" id="PyscalFactory.create_gaswater_list"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.PyscalFactory.create_gaswater_list">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">create_gaswater_list</span><span class="p">(</span>
        <span class="n">relperm_params_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fast</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PyscalList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a PyscalList with WaterOilGas objects from</span>
<span class="sd">        a dataframe, to be used for GasWater</span>

<span class="sd">        Args:</span>
<span class="sd">            relperm_params_df: A valid dataframe with GasWater</span>
<span class="sd">                parameters, processed through load_relperm_df()</span>
<span class="sd">            h: Saturation steplength</span>
<span class="sd">            fast: If fast-mode should be set for constructed object</span>

<span class="sd">        Returns:</span>
<span class="sd">            PyscalList, consisting of GasWater objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gwl</span> <span class="o">=</span> <span class="n">PyscalList</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="n">relperm_params_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">gwl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyscalFactory</span><span class="o">.</span><span class="n">create_gas_water</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">fast</span><span class="o">=</span><span class="n">fast</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error for SATNUM </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;SATNUM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="k">return</span> <span class="n">gwl</span></div></div>


<div class="viewcode-block" id="sufficient_water_oil_params"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.sufficient_water_oil_params">[docs]</a><span class="k">def</span> <span class="nf">sufficient_water_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">failhard</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Determine if the supplied parameters are sufficient for</span>
<span class="sd">    attempting creating a WaterOil object.</span>

<span class="sd">    In the factory context, relying on the defaults in the API</span>
<span class="sd">    is not allowed, as that would leave the tasks for the factory</span>
<span class="sd">    undefined (Corey or LET, and which pc?)</span>

<span class="sd">    Args:</span>
<span class="sd">        params: Dictionary of parameters to a WaterOil object.</span>
<span class="sd">        failhard: If True, will raise ValueError when</span>
<span class="sd">            parameters are insufficient. If defaulted, no</span>
<span class="sd">            exception is raised.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if a WaterOil object should be attempted constructed</span>
<span class="sd">        (but no guarantee for validity of numerical values)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=C1801</span>
    <span class="c1"># For case insensitiveness, all keys are converted to lower case:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="n">water_ok</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_COREY_WATER</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_LET_WATER</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="p">)</span>
    <span class="n">oil_ok</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_COREY_OIL</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_LET_OIL</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">3</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">WO_LET_OIL_ALT</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">failhard</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">water_ok</span> <span class="ow">and</span> <span class="n">oil_ok</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing WaterOil parameters in &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">water_ok</span> <span class="ow">and</span> <span class="n">oil_ok</span></div>


<div class="viewcode-block" id="sufficient_gas_oil_params"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.sufficient_gas_oil_params">[docs]</a><span class="k">def</span> <span class="nf">sufficient_gas_oil_params</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">failhard</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Determine if the supplied parameters are sufficient for</span>
<span class="sd">    attempting at creating a GasOil object.</span>

<span class="sd">    In the factory context, relying on the defaults in the API</span>
<span class="sd">    is not allowed, as that would leave the tasks for the factory</span>
<span class="sd">    undefined (Corey or LET, and which pc?)</span>

<span class="sd">    Args:</span>
<span class="sd">        params: Dictionary of parameters to a GasOil object.</span>
<span class="sd">        failhard: If True, will raise ValueError when</span>
<span class="sd">            parameters are insufficient. If defaulted, no</span>
<span class="sd">            exception is raised.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if a GasOil object should be attempted constructed</span>
<span class="sd">        (but no guarantee for validity of numerical values)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=C1801</span>
    <span class="c1"># For case insensitiveness, all keys are converted to lower case:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="n">oil_ok</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">GO_COREY_OIL</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">GO_LET_OIL</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="p">)</span>
    <span class="n">gas_ok</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">GO_COREY_GAS</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">GO_LET_GAS</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">failhard</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">oil_ok</span> <span class="ow">and</span> <span class="n">gas_ok</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing gas-oil parameters in &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">oil_ok</span> <span class="ow">and</span> <span class="n">gas_ok</span></div>


<div class="viewcode-block" id="sufficient_gas_water_params"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.sufficient_gas_water_params">[docs]</a><span class="k">def</span> <span class="nf">sufficient_gas_water_params</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">failhard</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Determine if the supplied parameters are sufficient for</span>
<span class="sd">    attempting creating a WaterOilGas object to be used for gas water.</span>

<span class="sd">    In the factory context, relying on the defaults in the API</span>
<span class="sd">    (wateroilgas.py) is not allowed, as that would leave the tasks</span>
<span class="sd">    for the factory undefined (Corey or LET, and which pc?)</span>

<span class="sd">    Args:</span>
<span class="sd">        params: Dictionary of parameters to a GasWater object.</span>
<span class="sd">        failhard: If True, will raise ValueError when</span>
<span class="sd">            parameters are insufficient. If defaulted, no</span>
<span class="sd">            exception is raised.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if a GasWater object should be attempted constructed</span>
<span class="sd">            (but no guarantee for validity of numerical values)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># pylint: disable=C1801</span>
    <span class="c1"># For case insensitiveness, all keys are converted to lower case:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">value</span> <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="n">water_ok</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">GW_COREY_WATER</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">GW_LET_WATER</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="p">)</span>
    <span class="n">gas_ok</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">GW_COREY_GAS</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">slicedict</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">GW_LET_GAS</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">failhard</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">water_ok</span> <span class="ow">and</span> <span class="n">gas_ok</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing gas-water parameters in &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">water_ok</span> <span class="ow">and</span> <span class="n">gas_ok</span></div>


<div class="viewcode-block" id="filter_nan_from_dict"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.filter_nan_from_dict">[docs]</a><span class="k">def</span> <span class="nf">filter_nan_from_dict</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Clean out keys with NaN values in a dict.</span>

<span class="sd">    Key with string values are passed through (empty strings are allowed)</span>

<span class="sd">    Args:</span>
<span class="sd">        params (dict): Any dictionary</span>

<span class="sd">    Returns</span>
<span class="sd">        dict, with as many or fewer keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cleaned_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">cleaned_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">cleaned_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">cleaned_params</span></div>


<div class="viewcode-block" id="infer_tabular_file_format"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.infer_tabular_file_format">[docs]</a><span class="k">def</span> <span class="nf">infer_tabular_file_format</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Determine the file format of a file containing tabular data,</span>
<span class="sd">    distinguishes between csv, xls and xlsx</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Path to file</span>

<span class="sd">    Returns:</span>
<span class="sd">        One of &quot;csv&quot;, &quot;xlsx&quot; or &quot;xls&quot;. Empty string if nothing found out.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;openpyxl&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;xlsx&quot;</span>
    <span class="k">except</span> <span class="p">(</span>
        <span class="ne">ValueError</span><span class="p">,</span>
        <span class="ne">OSError</span><span class="p">,</span>
        <span class="n">openpyxl</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InvalidFileException</span><span class="p">,</span>
        <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># &lt; Pandas 1.2, we get InvalidFileException from openpyxl</span>
        <span class="c1"># Pandas 1.2.0 - 1.2.1: CSV gives ValueError,</span>
        <span class="c1">#                       XLS gives OSError</span>
        <span class="c1"># &gt;= Pandas 1.2.2:      CSV gives zipfile.BadZipFile,</span>
        <span class="c1">#                       XLS gives OSError</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;xlrd&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;xls&quot;</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">biffh</span><span class="o">.</span><span class="n">XLRDError</span><span class="p">):</span>
        <span class="c1"># We get here for both CSV and XLSX files.</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="c1"># &gt;= 1.2.1: Pandas: Bugfix makes read_csv() more encoding fault</span>
        <span class="c1">#                   tolerant which this code opts out from.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dframe</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;csv&quot;</span>
    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
        <span class="c1"># (xls and xlsx files)</span>
        <span class="k">pass</span>
    <span class="k">except</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">ParserError</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">EmptyDataError</span><span class="p">)</span> <span class="k">as</span> <span class="n">csverror</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Message from CSV parser: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">csverror</span><span class="p">))</span>
        <span class="c1"># (Some text file that is not CSV)</span>

    <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="check_deprecated"><a class="viewcode-back" href="../../pyscal/pyscal.factory.html#pyscal.factory.check_deprecated">[docs]</a><span class="k">def</span> <span class="nf">check_deprecated</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Check for deprecated parameter names</span>

<span class="sd">    Args:</span>
<span class="sd">        params: Dictionary of parameters for which only the keys are used here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Block long deprecated parameters with an exception.</span>
    <span class="c1"># Remove this block in pyscal 1.x</span>
    <span class="k">if</span> <span class="s2">&quot;krowend&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">and</span> <span class="s2">&quot;kroend&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;krowend is not supported by pyscal. Use kroend&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;krogend&quot;</span> <span class="ow">in</span> <span class="n">params</span> <span class="ow">and</span> <span class="s2">&quot;kroend&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;krogend is not supported by pyscal. Use kroend&quot;</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Equinor 2019-2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #ff1243;
    }
    /* Sidebar */
    .wy-nav-side {
      background: #474747;
    }
    .wy-side-nav-search > div.version {
      color: white;
    }
  </style>


</body>
</html>